<html>
    <head>
        <title>Video Streaming Demonstration</title>

        <!-- bootstrap stuff -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

        <!-- custom css -->
        <style type="text/css">
            #bg {
                width: 100%
            }

            .face-container {
                width: 40%;
                /*height: 20%;*/
                display: inline-block;
            }

            .face {
                width: 100%;
                /*height: 100%;*/
            }
        </style>



    </head>
    <body>
        <div>
            <h1>Video Streaming Demonstration</h1>
        </div>
        <div class="row">
            <div class="col-md-8" id="video-feed-container">
                <!-- Video feed container -->
                <img id="bg" src="{{ url_for('video_feed') }}">
            </div>
            <div class="col-md-4" id="face-gallery-container">
                <!-- Container for all faces -->
                <!-- <div class="row"> -->
                    <div id="face-0" class="face-container">
                        <img src="/face/0" class="face">
                    </div>
                    <div id="face-1" class="face-container">
                        <img src="/face/1" class="face">
                    </div>
                    <div id="face-2" class="face-container">
                        <img src="/face/2" class="face">
                    </div>
                    <div id="face-3" class="face-container">
                        <img src="/face/3" class="face">
                    </div>
                    <div>
                        <button class="btn" id="refresh-btn">Refresh</button>
                    </div>
                <!-- </div> -->
            </div>
        </div>


        <script type="text/javascript">
            (function () {

                refreshFaces = function() {
                    console.log('refreshing faces');
                    const faceContainers = document.getElementById('face-gallery-container').childNodes;
                    for (var i = faceContainers.length - 1; i >= 0; i--) {
                        const container = faceContainers[i];
                        if (faceContainers[i].className === 'face-container') {
                            const containerChildren = container.childNodes;
                            for (var j = containerChildren.length - 1; j >= 0; j--) {
                                if (containerChildren[j].className === 'face') {
                                    const face = containerChildren[j];
                                    console.log(face);
                                    const source = face.src;
                                    // face.src = 'http://live.swamphacks.com/img/marstonfirst.png'
                                    face.src = source.split('?')[0] + '?lastmod=' + Math.random();
                                }
                            }
                        }
                    }
                };
                document.getElementById('refresh-btn').addEventListener('click', function() {
                        refreshFaces();
                    }
                );

            }) ();


        </script>
  </body>
</html>